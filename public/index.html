<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- The below line is for SEO. I have added meta description  -->
    <meta name="description" content="This is my personal budget website which I am developing for my Network Based Application Development Course.">
    <!-- Meta description works -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- The below line is for SEO. Fav icon added in the browser -->
    <link rel="icon" type="image/ico" href="favicon.ico"/>
    <!-- Fav Icon ended here -->

    <title>Personal Budget</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <!-- Added header for semantics -->
    <header>
       <!-- Added skip to content for A11y --> 
    <a class="skip-to-content-link" href="#main">git 
        Skip to content
      </a>
    <div class="menu">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="https://google.com" target="blank">Google</a></li>
        </ul>
    </div>
    </header>
    <div class="hero">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
    </div>

    <div id = "main" class="container center">

        <div class="page-area">

            <div class="text-box">
                <!-- Added section for semantics -->
                <section>
                <h1>Stay on track</h1>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that! 
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">stay on track</a></p>
                </p>
            </section>
            </div>

            <div class="text-box">
                <!-- Added section for semantics -->
                <section>
                <h1>Results</h1>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they to live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">generate Results</a></p>
                </p>
            </section>
            </div>
    
            <div class="text-box">
                <!-- Added section for semantics -->
                <section>
                <h1>Alerts</h1>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">create Alerts</a></p>
                </p>
            </section>
            </div>
    
            <div class="text-box">
                <!-- Added section for semantics -->
                <section>
                <h1>Free</h1>
                <p>
                    This app is free!!! And you are the only one holding your data! Terms and Conditions apply.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">Terms and Conditions</a></p>
                </p>
            </section>
            </div>
    
            <div class="text-box">
                <!-- Added section for semantics -->
                <section>
                <h1>Stay on track</h1>
                <p>
                    Do you know where you are spending your money? If you really stop to track it down,
                    you would get surprised! Proper budget management depends on real data... and this
                    app will help you with that!
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">stay on track</a></p>
                </p>
            </section>
            </div>

            <div class="text-box">
                 <!-- Added section for semantics -->
                <section>
                <h1>Results</h1>
                <p>
                    People who stick to a financial plan, budgeting every expense, get out of debt faster!
                    Also, they to live happier lives... since they expend without guilt or fear... 
                    because they know it is all good and accounted for.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">generate Results</a></p>
                </p>
            </section>
            </div>
    
            <div class="text-box">
                 <!-- Added section for semantics -->
                <section>
                <h1>Alerts</h1>
                <p>
                    What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">create Alerts</a></p>
                </p>
            </section>
            </div>
    
    
            <div class="text-box">
                 <!-- Added section for semantics -->
                <section>
                <h1>Free</h1>
                <p>
                    This app is free!!! And you are the only one holding your data! Terms and Conditions apply.
                    <!-- Creating good link text - SEO -->
                    <p>Read more about how to <a href="sectionDetail.html">Terms and Conditions</a></p>
                </p>
            </section>
            </div>


            <div class="chart-container" style="position: relative; width:700px; margin:auto">
                <canvas id="myChart"></canvas>
                </div>
                
                <div class="another-chart-container"></div>
        </div>
        
    </div>


    <!-- Added footer for semantics -->
    <footer>
    <div class="bottom">
        <div class="center">
            All rights reserved &copy; Fabio Nolasco
        </div>
    </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>

    <script>

        //The below code is for chart js

dataChart = {
    datasets: [{
        data: [],
        backgroundColor:[],
    }],

    labels: []
};

function createChart(){
    var ctx = document.getElementById("myChart").getContext("2d");
    var myPieChart = new Chart(ctx, {
        type: 'doughnut',
        data : dataChart
    }) ;
}

function getBudget(){
    axios.get('/budget').then(function(res){
            console.log(res.data.myBudget.title);
            for(var i=0; i<res.data.myBudget.length; i++){
                dataChart.datasets[0].data[i] = res.data.myBudget[i].budget;
                dataChart.labels[i] = res.data.myBudget[i].title;
                dataChart.datasets[0].backgroundColor[i] = res.data.myBudget[i].color;
            }
            createChart();
    });
}
getBudget();


//The below code is for D3js

var svg = d3.select(".another-chart-container")
	.append("svg")
	.append("g")

svg.append("g")
	.attr("class", "slices");
svg.append("g")
	.attr("class", "labels");
svg.append("g")
	.attr("class", "lines");

var width = 600,
    height = 500,
	radius = Math.min(width, height) / 2;

var pie = d3.layout.pie()
	.sort(null)
	.value(function(d) {
		return d.value;
	});

var arc = d3.svg.arc()
	.outerRadius(radius * 0.8)
	.innerRadius(radius * 0.4);

var outerArc = d3.svg.arc()
	.innerRadius(radius * 0.9)
	.outerRadius(radius * 0.9);

svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var key = function(d){ return d.data.label; };
var color;
var array = [];
var range = [];
var backgroundColor = [];

d3.json("/budget", function(data) {
    console.log(data["myBudget"].length);
    
    for(var i = 0; i<data["myBudget"].length; i++){
        array[i] = data["myBudget"][i].title;
        range[i] = data["myBudget"][i].budget;
        backgroundColor[i] = data["myBudget"].color;
        console.log(array[i]);
    }

  
    var color = d3.scale
    .ordinal()
	.domain(array)
    .range(range);
function randomData (){
    var labels = color.domain();
    var rangeValues = color.range();
    console.log(labels);
    var i = 0;
    var j = 0;
	return labels.map(function(label){
		return { label: labels[i++], value: rangeValues[j++] }
	});
}

change(randomData());


function change(data) {

	/* ------- PIE SLICES -------*/
	var slice = svg.select(".slices").selectAll("path.slice")
		.data(pie(data), key);

	slice.enter()
		.insert("path")
		.style("fill", function(d) { return color(d.data.label); })
		.attr("class", "slice");

	slice		
		.transition().duration(1000)
		.attrTween("d", function(d) {
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				return arc(interpolate(t));
			};
		})

	slice.exit()
		.remove();

	/* ------- TEXT LABELS -------*/

	var text = svg.select(".labels").selectAll("text")
		.data(pie(data), key);

	text.enter()
		.append("text")
		.attr("dy", ".35em")
		.text(function(d) {
			return d.data.label;
		});
	
	function midAngle(d){
		return d.startAngle + (d.endAngle - d.startAngle)/2;
	}

	text.transition().duration(1000)
		.attrTween("transform", function(d) {
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				var pos = outerArc.centroid(d2);
				pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
				return "translate("+ pos +")";
			};
		})
		.styleTween("text-anchor", function(d){
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				return midAngle(d2) < Math.PI ? "start":"end";
			};
		});

	text.exit()
		.remove();

	/* ------- SLICE TO TEXT POLYLINES -------*/

	var polyline = svg.select(".lines").selectAll("polyline")
		.data(pie(data), key);
	
	polyline.enter()
		.append("polyline");

	polyline.transition().duration(1000)
		.attrTween("points", function(d){
			this._current = this._current || d;
			var interpolate = d3.interpolate(this._current, d);
			this._current = interpolate(0);
			return function(t) {
				var d2 = interpolate(t);
				var pos = outerArc.centroid(d2);
				pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
				return [arc.centroid(d2), outerArc.centroid(d2), pos];
			};			
		});
	
	polyline.exit()
		.remove();
};

});



    </script>

</body>
</html>